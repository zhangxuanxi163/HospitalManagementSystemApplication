# 排查启动问题 - localhost拒绝连接

## 问题分析

"localhost 拒绝连接" 通常表示：
1. **项目没有成功启动**（最常见）
2. 启动失败但错误被忽略了
3. 端口被其他程序占用
4. 防火墙阻止连接

## ✅ 不需要Apache！

这是Spring Boot应用，使用**内嵌的Tomcat服务器**，不需要安装Apache。

---

## 🔍 排查步骤

### 步骤1：检查项目是否真的启动了

在IDE的控制台（Console）中查看：

**✅ 启动成功的标志**：
```
Started HospitalManagementSystemApplication in X.XXX seconds
```

**❌ 如果看到错误信息**：
- 数据库连接错误
- 端口被占用
- 编译错误
- 依赖缺失

### 步骤2：检查控制台日志

查看IDE底部的控制台输出，寻找：

1. **启动日志**：
   ```
   .   ____          _            __ _ _
    /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
   ...
   Started HospitalManagementSystemApplication
   ```

2. **Tomcat启动信息**：
   ```
   Tomcat started on port(s): 8080 (http)
   ```

3. **错误信息**（如果有）：
   - 红色错误信息
   - 异常堆栈

### 步骤3：检查端口是否被占用

在PowerShell中执行：
```powershell
netstat -ano | findstr :8080
```

**如果有输出**：说明8080端口已被占用
**如果没有输出**：说明项目没有启动

### 步骤4：检查数据库连接

**常见错误**：
```
com.mysql.cj.jdbc.exceptions.CommunicationsException
```

**解决方法**：
1. 确保MySQL服务已启动
2. 检查 `application.yml` 中的数据库配置
3. 确保数据库 `hospital_db` 已创建

---

## 🛠️ 常见问题解决

### 问题1：项目启动失败（最常见）

**症状**：控制台有红色错误信息

**解决方法**：
1. **查看完整错误信息**（滚动控制台）
2. **根据错误类型解决**：
   - 数据库连接失败 → 检查MySQL和配置
   - 端口被占用 → 修改端口或关闭占用程序
   - 编译错误 → Clean → Rebuild

### 问题2：端口被占用

**错误信息**：
```
Port 8080 is already in use
```

**解决方法A - 修改端口**：
编辑 `src/main/resources/application.yml`：
```yaml
server:
  port: 8081  # 改为其他端口
```
然后访问：http://localhost:8081/hospital

**解决方法B - 关闭占用程序**：
```powershell
# 查找占用8080端口的进程
netstat -ano | findstr :8080
# 记住PID，然后结束进程
taskkill /PID <进程ID> /F
```

### 问题3：数据库连接失败

**错误信息**：
```
Communications link failure
Access denied for user
```

**解决步骤**：
1. **检查MySQL服务**：
   - 打开"服务"（services.msc）
   - 找到MySQL服务，确保状态为"正在运行"

2. **测试数据库连接**：
   ```sql
   -- 在MySQL命令行中测试
   mysql -u root -p
   -- 输入密码，能登录说明MySQL正常
   ```

3. **检查数据库是否存在**：
   ```sql
   SHOW DATABASES;
   -- 应该能看到 hospital_db
   ```

4. **检查配置文件**：
   打开 `src/main/resources/application.yml`，确认：
   ```yaml
   spring:
     datasource:
       url: jdbc:mysql://localhost:3306/hospital_db?...
       username: root        # 你的MySQL用户名
       password: root        # 你的MySQL密码
   ```

### 问题4：依赖未下载

**症状**：编译错误，找不到类

**解决方法**：
1. 右键 `pom.xml` → Maven → Reload Project
2. 等待依赖下载完成
3. Build → Rebuild Project

---

## 📋 完整启动检查清单

按顺序检查：

- [ ] **1. MySQL服务已启动**
  - 打开"服务"，确认MySQL服务运行中

- [ ] **2. 数据库已创建**
  ```sql
  CREATE DATABASE hospital_db;
  ```

- [ ] **3. 配置文件已修改**
  - `application.yml` 中的用户名密码正确

- [ ] **4. 项目已编译**
  - Build → Rebuild Project 成功

- [ ] **5. 项目已启动**
  - 控制台显示 "Started HospitalManagementSystemApplication"
  - 没有红色错误信息

- [ ] **6. 端口正常监听**
  - `netstat -ano | findstr :8080` 有输出

- [ ] **7. 浏览器访问**
  - http://localhost:8080/hospital

---

## 🚀 重新启动步骤

如果项目没有启动，按以下步骤重新启动：

1. **停止当前运行**（如果有）
   - 在IDE中点击停止按钮（红色方块）

2. **清理项目**
   - Build → Clean Project

3. **重新编译**
   - Build → Rebuild Project

4. **检查错误**
   - 查看是否有编译错误
   - 如果有，先解决错误

5. **重新运行**
   - 右键 `HospitalManagementSystemApplication.java`
   - Run 'HospitalManagementSystemApplication'

6. **查看启动日志**
   - 仔细查看控制台输出
   - 确认没有错误

7. **验证端口**
   ```powershell
   netstat -ano | findstr :8080
   ```

---

## 💡 快速诊断命令

在PowerShell中执行，快速检查：

```powershell
# 检查8080端口
netstat -ano | findstr :8080

# 检查MySQL服务
Get-Service | Where-Object {$_.Name -like "*mysql*"}

# 检查Java进程
Get-Process | Where-Object {$_.ProcessName -like "*java*"}
```

---

## 📞 需要帮助？

如果以上方法都不行，请提供：

1. **IDE控制台的完整错误信息**（截图或复制）
2. **启动日志的最后几行**
3. **执行 `netstat -ano | findstr :8080` 的结果**

这样我可以更准确地帮你解决问题！

